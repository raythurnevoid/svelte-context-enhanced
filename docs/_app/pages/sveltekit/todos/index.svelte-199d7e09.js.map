{"version":3,"file":"index.svelte-199d7e09.js","sources":["../../../../../../../src/lib/form.ts","../../../../../../../src/routes/sveltekit/todos/index.svelte"],"sourcesContent":["// this action (https://svelte.dev/tutorial/actions) allows us to\r\n// progressively enhance a <form> that already works without JS\r\nexport function enhance(\r\n\tform: HTMLFormElement,\r\n\t{\r\n\t\tpending,\r\n\t\terror,\r\n\t\tresult\r\n\t}: {\r\n\t\tpending?: (data: FormData, form: HTMLFormElement) => void;\r\n\t\terror?: (res: Response, error: Error, form: HTMLFormElement) => void;\r\n\t\tresult: (res: Response, form: HTMLFormElement) => void;\r\n\t}\r\n) {\r\n\tlet current_token: {};\r\n\r\n\tasync function handle_submit(e: Event) {\r\n\t\tconst token = (current_token = {});\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tconst body = new FormData(form);\r\n\r\n\t\tif (pending) pending(body, form);\r\n\r\n\t\ttry {\r\n\t\t\tconst res = await fetch(form.action, {\r\n\t\t\t\tmethod: form.method,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\taccept: 'application/json'\r\n\t\t\t\t},\r\n\t\t\t\tbody\r\n\t\t\t});\r\n\r\n\t\t\tif (token !== current_token) return;\r\n\r\n\t\t\tif (res.ok) {\r\n\t\t\t\tresult(res, form);\r\n\t\t\t} else if (error) {\r\n\t\t\t\terror(res, null, form);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(await res.text());\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tif (error) {\r\n\t\t\t\terror(null, e, form);\r\n\t\t\t} else {\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tform.addEventListener('submit', handle_submit);\r\n\r\n\treturn {\r\n\t\tdestroy() {\r\n\t\t\tform.removeEventListener('submit', handle_submit);\r\n\t\t}\r\n\t};\r\n}\r\n","<script context=\"module\" lang=\"ts\">\r\n\timport { enhance } from '$lib/form';\r\n\timport type { Load } from '@sveltejs/kit';\r\n\r\n\t// see https://kit.svelte.dev/docs#loading\r\n\texport const load: Load = async ({ fetch }) => {\r\n\t\tconst res = await fetch('/sveltekit/todos.json');\r\n\r\n\t\tif (res.ok) {\r\n\t\t\tconst todos = await res.json();\r\n\r\n\t\t\treturn {\r\n\t\t\t\tprops: { todos }\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst { message } = await res.json();\r\n\r\n\t\treturn {\r\n\t\t\terror: new Error(message)\r\n\t\t};\r\n\t};\r\n</script>\r\n\r\n<script lang=\"ts\">\r\n\timport { scale } from 'svelte/transition';\r\n\timport { flip } from 'svelte/animate';\r\n\r\n\ttype Todo = {\r\n\t\tuid: string;\r\n\t\tcreated_at: Date;\r\n\t\ttext: string;\r\n\t\tdone: boolean;\r\n\t};\r\n\r\n\texport let todos: Todo[];\r\n\r\n\tasync function patch(res: Response) {\r\n\t\tconst todo = await res.json();\r\n\r\n\t\ttodos = todos.map((t) => {\r\n\t\t\tif (t.uid === todo.uid) return todo;\r\n\t\t\treturn t;\r\n\t\t});\r\n\t}\r\n</script>\r\n\r\n<svelte:head>\r\n\t<title>Todos</title>\r\n</svelte:head>\r\n\r\n<div class=\"todos\">\r\n\t<h1>Todos</h1>\r\n\r\n\t<form\r\n\t\tclass=\"new\"\r\n\t\taction=\"/sveltekit/todos.json\"\r\n\t\tmethod=\"post\"\r\n\t\tuse:enhance={{\r\n\t\t\tresult: async (res, form) => {\r\n\t\t\t\tconst created = await res.json();\r\n\t\t\t\ttodos = [...todos, created];\r\n\r\n\t\t\t\tform.reset();\r\n\t\t\t}\r\n\t\t}}\r\n\t>\r\n\t\t<input name=\"text\" aria-label=\"Add todo\" placeholder=\"+ tap to add a todo\" />\r\n\t</form>\r\n\r\n\t{#each todos as todo (todo.uid)}\r\n\t\t<div\r\n\t\t\tclass=\"todo\"\r\n\t\t\tclass:done={todo.done}\r\n\t\t\ttransition:scale|local={{ start: 0.7 }}\r\n\t\t\tanimate:flip={{ duration: 200 }}\r\n\t\t>\r\n\t\t\t<form\r\n\t\t\t\taction=\"/sveltekit/todos/{todo.uid}.json?_method=patch\"\r\n\t\t\t\tmethod=\"post\"\r\n\t\t\t\tuse:enhance={{\r\n\t\t\t\t\tpending: (data) => {\r\n\t\t\t\t\t\ttodo.done = !!data.get('done');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresult: patch\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<input type=\"hidden\" name=\"done\" value={todo.done ? '' : 'true'} />\r\n\t\t\t\t<button class=\"toggle\" aria-label=\"Mark todo as {todo.done ? 'not done' : 'done'}\" />\r\n\t\t\t</form>\r\n\r\n\t\t\t<form\r\n\t\t\t\tclass=\"text\"\r\n\t\t\t\taction=\"/sveltekit/todos/{todo.uid}.json?_method=patch\"\r\n\t\t\t\tmethod=\"post\"\r\n\t\t\t\tuse:enhance={{\r\n\t\t\t\t\tresult: patch\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<input aria-label=\"Edit todo\" type=\"text\" name=\"text\" value={todo.text} />\r\n\t\t\t\t<button class=\"save\" aria-label=\"Save todo\" />\r\n\t\t\t</form>\r\n\r\n\t\t\t<form\r\n\t\t\t\taction=\"/sveltekit/todos/{todo.uid}.json?_method=delete\"\r\n\t\t\t\tmethod=\"post\"\r\n\t\t\t\tuse:enhance={{\r\n\t\t\t\t\tresult: () => {\r\n\t\t\t\t\t\ttodos = todos.filter((t) => t.uid !== todo.uid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<button class=\"delete\" aria-label=\"Delete todo\" />\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t{/each}\r\n</div>\r\n\r\n<style>\r\n\t.todos {\r\n\t\twidth: 100%;\r\n\t\tmax-width: var(--column-width);\r\n\t\tmargin: var(--column-margin-top) auto 0 auto;\r\n\t\tline-height: 1;\r\n\t}\r\n\r\n\t.new {\r\n\t\tmargin: 0 0 0.5rem 0;\r\n\t}\r\n\r\n\tinput {\r\n\t\tborder: 1px solid transparent;\r\n\t}\r\n\r\n\tinput:focus-visible {\r\n\t\tbox-shadow: inset 1px 1px 6px rgba(0, 0, 0, 0.1);\r\n\t\tborder: 1px solid #ff3e00 !important;\r\n\t\toutline: none;\r\n\t}\r\n\r\n\t.new input {\r\n\t\tfont-size: 28px;\r\n\t\twidth: 100%;\r\n\t\tpadding: 0.5em 1em 0.3em 1em;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: rgba(255, 255, 255, 0.05);\r\n\t\tborder-radius: 8px;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.todo {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: 2rem 1fr 2rem;\r\n\t\tgrid-gap: 0.5rem;\r\n\t\talign-items: center;\r\n\t\tmargin: 0 0 0.5rem 0;\r\n\t\tpadding: 0.5rem;\r\n\t\tbackground-color: white;\r\n\t\tborder-radius: 8px;\r\n\t\tfilter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.1));\r\n\t\ttransform: translate(-1px, -1px);\r\n\t\ttransition: filter 0.2s, transform 0.2s;\r\n\t}\r\n\r\n\t.done {\r\n\t\ttransform: none;\r\n\t\topacity: 0.4;\r\n\t\tfilter: drop-shadow(0px 0px 1px rgba(0, 0, 0, 0.1));\r\n\t}\r\n\r\n\tform.text {\r\n\t\tposition: relative;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.todo input {\r\n\t\tflex: 1;\r\n\t\tpadding: 0.5em 2em 0.5em 0.8em;\r\n\t\tborder-radius: 3px;\r\n\t}\r\n\r\n\t.todo button {\r\n\t\twidth: 2em;\r\n\t\theight: 2em;\r\n\t\tborder: none;\r\n\t\tbackground-color: transparent;\r\n\t\tbackground-position: 50% 50%;\r\n\t\tbackground-repeat: no-repeat;\r\n\t}\r\n\r\n\tbutton.toggle {\r\n\t\tborder: 1px solid rgba(0, 0, 0, 0.2);\r\n\t\tborder-radius: 50%;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-size: 1em auto;\r\n\t}\r\n\r\n\t.done .toggle {\r\n\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='22' height='16' viewBox='0 0 22 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20.5 1.5L7.4375 14.5L1.5 8.5909' stroke='%23676778' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E\");\r\n\t}\r\n\r\n\t.delete {\r\n\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4.5 5V22H19.5V5H4.5Z' fill='%23676778' stroke='%23676778' stroke-width='1.5' stroke-linejoin='round'/%3E%3Cpath d='M10 10V16.5' stroke='white' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M14 10V16.5' stroke='white' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M2 5H22' stroke='%23676778' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M8 5L9.6445 2H14.3885L16 5H8Z' fill='%23676778' stroke='%23676778' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\r\n\t\topacity: 0.2;\r\n\t}\r\n\r\n\t.delete:hover,\r\n\t.delete:focus {\r\n\t\ttransition: opacity 0.2s;\r\n\t\topacity: 1;\r\n\t}\r\n\r\n\t.save {\r\n\t\tposition: absolute;\r\n\t\tright: 0;\r\n\t\topacity: 0;\r\n\t\tbackground-image: url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20.5 2H3.5C2.67158 2 2 2.67157 2 3.5V20.5C2 21.3284 2.67158 22 3.5 22H20.5C21.3284 22 22 21.3284 22 20.5V3.5C22 2.67157 21.3284 2 20.5 2Z' fill='%23676778' stroke='%23676778' stroke-width='1.5' stroke-linejoin='round'/%3E%3Cpath d='M17 2V11H7.5V2H17Z' fill='white' stroke='white' stroke-width='1.5' stroke-linejoin='round'/%3E%3Cpath d='M13.5 5.5V7.5' stroke='%23676778' stroke-width='1.5' stroke-linecap='round'/%3E%3Cpath d='M5.99844 2H18.4992' stroke='%23676778' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E%0A\");\r\n\t}\r\n\r\n\t.todo input:focus + .save,\r\n\t.save:focus {\r\n\t\ttransition: opacity 0.2s;\r\n\t\topacity: 1;\r\n\t}\r\n</style>\r\n"],"names":[],"mappings":";iBAGC,MACA;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,GAMA;MACG;+BAEyB,GAAU;UAChC,QAAS,gBAAgB;MAE7B;UAEI,OAAO,IAAI,SAAS;QAEtB;cAAiB,MAAM;QAEvB;YACG,MAAM,MAAM,MAAM,KAAK,QAAQ;AAAA,QACpC,QAAQ,KAAK;AAAA,QACb,SAAS;AAAA,UACR,QAAQ;AAAA;AAAA,QAET;AAAA;UAGG,UAAU;;UAEV,IAAI,IAAI;eACJ,KAAK;AAAA,iBACF,OAAO;cACX,KAAK,MAAM;AAAA,aACX;gBACE,MAAM,MAAM,IAAI;AAAA;AAAA,aAEjB;UACJ,OAAO;cACJ,MAAM,IAAG;AAAA,aACT;cACA;AAAA;AAAA;AAAA;OAKJ,iBAAiB,UAAU;SAEzB;AAAA,IACN,UAAU;WACJ,oBAAoB,UAAU;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CC+BM,OAAK,OAAO,KAAK;;;+EACR,QAAK,OAAO,aAAa;uEAVhD,OAAK;;;;;0CAqB8B,OAAK;;;;;uEANxC,OAAK;;;;uEAWL,OAAK;;;gCA/BpB,OAAK;;;;;;;;;;;;;;;;;;;;;;YAQf;YAGA,QAAQ;;uDAYR,QAAQ;0EAWR;;;;;;;gFApBuC,OAAK,OAAO,KAAK;;;8GACR,QAAK,OAAO,aAAa;;;sGAVhD,OAAK;;;;;UAG9B;UAGA,QAAQ;;gFAeoD,OAAK;;;sGANxC,OAAK;;;sGAWL,OAAK;;;;6CAG9B;;kCAlCU,OAAK;AAAA;AAAA;AAAA;;;;;;;;;;2DAED,UAAU;AAAA;AAAA;;;;;;2EADA,OAAO;;;;;;;;;yEAAP,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mBAJ5B;4BAAe,QAAK;iCAAzB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+EAXA;;;;;;2CAAA;;qBAWK;;;;;;;;;;;;;qCAAL;;;;;;;;;;;;;;;;;;;;;;;;IAtE+B,qBAAA,SAAA,YAAA,GAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;MAKpB,UAAsB,oBAAW;QACvC,YAAY,OAAM;MAEpB,IAAI;UACD,cAAc,IAAI;aAGvB,SAAS;AAAA;UAIH,kBAAkB,IAAI;WAG7B,WAAW,MAAM;AAAA;;MAKH,aAAA,QAAA,KAAA,sBAAA,SAAA,YAAA,GAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;QAWL;iBAEU;;YACd,aAAa,IAAI;sBAEvB,QAAQ,MAAM,IAAK;YACd,EAAE,QAAQ,KAAK;iBAAY;eACxB;AAAA;AAAA;AAAA;kCAiBQ,KAAK;UACb,gBAAgB,IAAI;oBAC1B,YAAY,OAAO;AAEnB,SAAK;AAAA;4DAkBM;2CACJ,SAAS,KAAK,IAAI;;;oBA0BvB,QAAQ,MAAM,OAAQ,OAAM,EAAE,QAAQ,KAAK;AAAA;;;;;;;;;;;;;;;"}